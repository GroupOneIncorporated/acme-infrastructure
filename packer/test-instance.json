{
  "builders": [
    {
      "type": "openstack",
      "image_name": "test-instance",
      "source_image_name": "Debian 9",
      "flavor": "c2-r2-d20",
      "ssh_username": "debian",
      
      "networks": ["dfb1e3ea-613c-4d4f-bce1-6435043832d5"],
      "floating_ip_network": "fd401e50-9484-4883-9672-a2814089528c",
      "availability_zone": "Education",
      "security_groups": [
        "default",
        "k8s_secgroup"
      ]
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "../ansible/",
      "destination": "/tmp/"
    },
    {
      "type": "shell",
      "inline":[
        "sudo apt-get update",
        "sudo apt-get -y install dirmngr --install-recommends",
        "sudo bash -c \"echo 'deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main' >> /etc/apt/source.list\"",
        "sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 93C4A3FD7BB9C367",
        "sudo apt update",
        "yes | sudo apt install ansible",
        "echo \"**** ANSIBLE LOCATION: $(which ansible) ****\"",
        
        "yes | sudo apt install git",
        "cd /tmp",
        "git clone https://github.com/brocahontaz/terraglue /tmp/glue",
        "cd glue",
        "echo \"**** installing GLUE ****\"",
        "npm install"
      ]
    },
    {
      "type": "file",
      "source": "../glue/src/configs/acme-infrastructure.json",
      "destination": "/tmp/glue/src/configs"
    },
    {
      "type": "shell",
      "inline": [
        "npm start acme-infrastructure.json"
      ]
    }
  ]
}
