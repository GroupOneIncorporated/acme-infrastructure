!function(e){e.Jcrop=function(t,n){function s(e){return parseInt(e)+"px"}function r(e){return parseInt(e)+"%"}function o(e){return j.baseClass+"-"+e}function a(t){var n=e(t).offset();return[n.left,n.top]}function c(e){return[e.pageX-se[0],e.pageY-se[1]]}function u(e){e!=L&&(ie.setCursor(e),L=e)}function d(e,t){if(se=a(K),ie.setCursor("move"==e?e:e+"-resize"),"move"==e)return ie.activateHandlers(f(t),g);var n=re.getFixed(),s=p(e),r=re.getCorner(p(s));re.setPressed(re.getCorner(s)),re.setCurrent(r),ie.activateHandlers(l(e,n),g)}function l(e,t){return function(n){if(j.aspectRatio)switch(e){case"e":case"w":n[1]=t.y+1;break;case"n":case"s":n[0]=t.x+1}else switch(e){case"e":case"w":n[1]=t.y2;break;case"n":case"s":n[0]=t.x2}re.setCurrent(n),oe.update()}}function f(e){var t=e;return ae.watchKeys(),function(e){re.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,oe.update()}}function p(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function b(e){return function(t){return!j.disabled&&(!("move"==e&&!j.allowMove)&&(G=!0,d(e,c(t)),t.stopPropagation(),t.preventDefault(),!1))}}function v(e){return{x:parseInt(e.x*Y),y:parseInt(e.y*q),x2:parseInt(e.x2*Y),y2:parseInt(e.y2*q),w:parseInt(e.w*Y),h:parseInt(e.h*q)}}function g(e){var t=re.getFixed();t.w>j.minSelect[0]&&t.h>j.minSelect[1]?(oe.enableHandles(),oe.done()):oe.release(),ie.setCursor(j.allowSelect?"crosshair":"default")}function m(e){if(j.disabled)return!1;if(!j.allowSelect)return!1;G=!0,se=a(K),oe.disableHandles(),u("crosshair");var t=c(e);return re.setPressed(t),ie.activateHandlers(y,g),ae.watchKeys(),oe.update(),e.stopPropagation(),e.preventDefault(),!1}function y(e){re.setCurrent(e),oe.update()}function x(){var t=e("<div></div>").addClass(o("tracker"));return e.browser.msie&&t.css({opacity:0,backgroundColor:"white"}),t}function C(e){function t(){window.setTimeout(g,u)}var n=e[0]/Y,s=e[1]/q,r=e[2]/Y,o=e[3]/q;if(!N){var i=re.flipCoords(n,s,r,o),a=re.getFixed(),c=initcr=[a.x,a.y,a.x2,a.y2],u=j.animationDelay,d=c[0],l=c[1],r=c[2],o=c[3],f=i[0]-initcr[0],h=i[1]-initcr[1],p=i[2]-initcr[2],w=i[3]-initcr[3],b=0,v=j.swingSpeed;oe.animMode(!0);var g=function(){return function(){b+=(100-b)/v,c[0]=d+b/100*f,c[1]=l+b/100*h,c[2]=r+b/100*p,c[3]=o+b/100*w,b<100?t():oe.done(),b>=99.8&&(b=100),z(c)}}();t()}}function S(e){z([e[0]/Y,e[1]/q,e[2]/Y,e[3]/q])}function z(e){re.setPressed([e[0],e[1]]),re.setCurrent([e[2],e[3]]),oe.update()}function k(t){"object"!=typeof t&&(t={}),j=e.extend(j,t),"function"!=typeof j.onChange&&(j.onChange=function(){}),"function"!=typeof j.onSelect&&(j.onSelect=function(){})}function M(){return v(re.getFixed())}function I(){return re.getFixed()}function H(e){k(e),J()}function O(){j.disabled=!0,oe.disableHandles(),oe.setCursor("default"),ie.setCursor("default")}function D(){j.disabled=!1,J()}function F(){oe.done(),ie.activateHandlers(null,null)}function P(){E.remove(),B.show()}function J(e){j.allowResize?e?oe.enableOnly():oe.enableHandles():oe.disableHandles(),ie.setCursor(j.allowSelect?"crosshair":"default"),oe.setCursor(j.allowMove?"move":"default"),E.css("backgroundColor",j.bgColor),"setSelect"in j&&(S(n.setSelect),oe.done(),delete j.setSelect),"trueSize"in j&&(Y=j.trueSize[0]/W,q=j.trueSize[1]/A),T=j.maxSize[0]||0,V=j.maxSize[1]||0,Q=j.minSize[0]||0,X=j.minSize[1]||0,"outerImage"in j&&(K.attr("src",j.outerImage),delete j.outerImage),oe.refresh()}var t=t,n=n;"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),"trackDocument"in n||(n.trackDocument=!e.browser.msie,e.browser.msie&&"8"==e.browser.version.split(".")[0]&&(n.trackDocument=!0)),"keySupport"in n||(n.keySupport=!e.browser.msie);var R={trackDocument:!1,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:!0,allowMove:!0,allowResize:!0,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}},j=R;k(n);var B=e(t),K=B.clone().removeAttr("id").css({position:"absolute"});K.width(B.width()),K.height(B.height()),B.after(K).hide(),function(e,t,n){var s=e.width(),r=e.height();s>t&&t>0&&(s=t,r=t/e.width()*e.height()),r>n&&n>0&&(r=n,s=n/e.height()*e.width()),Y=e.width()/s,q=e.height()/r,e.width(s).height(r)}(K,j.boxWidth,j.boxHeight);var W=K.width(),A=K.height(),E=e("<div />").width(W).height(A).addClass(o("holder")).css({position:"relative",backgroundColor:j.bgColor}).insertAfter(B).append(K);j.addClass&&E.addClass(j.addClass);var T,V,Q,X,Y,q,G,L,N,U,Z=e("<img />").attr("src",K.attr("src")).css("position","absolute").width(W).height(A),$=e("<div />").width(r(100)).height(r(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(Z),_=e("<div />").width(r(100)).height(r(100)).css("zIndex",320),ee=e("<div />").css({position:"absolute",zIndex:300}).insertBefore(K).append($,_),te=j.boundary,ne=x().width(W+2*te).height(A+2*te).css({position:"absolute",top:s(-te),left:s(-te),zIndex:290}).mousedown(m),se=a(K),re=function(){function e(e){var e=i(e);b=f=e[0],v=p=e[1]}function t(e){var e=i(e);d=e[0]-b,l=e[1]-v,b=e[0],v=e[1]}function n(){return[d,l]}function s(e){var t=e[0],n=e[1];0>f+t&&(t-=t+f),0>p+n&&(n-=n+p),A<v+n&&(n+=A-(v+n)),W<b+t&&(t+=W-(b+t)),f+=t,b+=t,p+=n,v+=n}function r(e){var t=o();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function o(){if(!j.aspectRatio)return c();var e,t,n=j.aspectRatio,s=j.minSize[0]/Y,r=(j.minSize[1],j.maxSize[0]/Y),o=j.maxSize[1]/q,i=b-f,d=v-p,l=Math.abs(i),g=Math.abs(d),m=l/g;return 0==r&&(r=10*W),0==o&&(o=10*A),m<n?(t=v,w=g*n,e=i<0?f-w:w+f,e<0?(e=0,h=Math.abs((e-f)/n),t=d<0?p-h:h+p):e>W&&(e=W,h=Math.abs((e-f)/n),t=d<0?p-h:h+p)):(e=b,h=l/n,t=d<0?p-h:p+h,t<0?(t=0,w=Math.abs((t-p)*n),e=i<0?f-w:w+f):t>A&&(t=A,w=Math.abs(t-p)*n,e=i<0?f-w:w+f)),e>f?(e-f<s?e=f+s:e-f>r&&(e=f+r),t=t>p?p+(e-f)/n:p-(e-f)/n):e<f&&(f-e<s?e=f-s:f-e>r&&(e=f-r),t=t>p?p+(f-e)/n:p-(f-e)/n),e<0?(f-=e,e=0):e>W&&(f-=e-W,e=W),t<0?(p-=t,t=0):t>A&&(p-=t-A,t=A),last=u(a(f,p,e,t))}function i(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>W&&(e[0]=W),e[1]>A&&(e[1]=A),[e[0],e[1]]}function a(e,t,n,s){var r=e,o=n,i=t,a=s;return n<e&&(r=n,o=e),s<t&&(i=s,a=t),[Math.round(r),Math.round(i),Math.round(o),Math.round(a)]}function c(){var e=b-f,t=v-p;if(T&&Math.abs(e)>T&&(b=e>0?f+T:f-T),V&&Math.abs(t)>V&&(v=t>0?p+V:p-V),X&&Math.abs(t)<X&&(v=t>0?p+X:p-X),Q&&Math.abs(e)<Q&&(b=e>0?f+Q:f-Q),f<0&&(b-=f,f-=f),p<0&&(v-=p,p-=p),b<0&&(f-=b,b-=b),v<0&&(p-=v,v-=v),b>W){var n=b-W;f-=n,b-=n}if(v>A){var n=v-A;p-=n,v-=n}if(f>W){var n=f-A;v-=n,p-=n}if(p>A){var n=p-A;v-=n,p-=n}return u(a(f,p,b,v))}function u(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var d,l,f=0,p=0,b=0,v=0;return{flipCoords:a,setPressed:e,setCurrent:t,getOffset:n,moveOffset:s,getCorner:r,getFixed:o}}(),oe=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:j.borderOpacity}).addClass(o(t));return $.append(n),n}function n(t,n){var s=e("<div />").mousedown(b(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n});return _.append(s),s}function a(e){return n(e,I++).css({top:s(1-F),left:s(1-F),opacity:j.handleOpacity}).addClass(o("handle"))}function c(e){var t=j.handleSize,o=F,i=t,a=t,c=o,u=o;switch(e){case"n":case"s":a=r(100);break;case"e":case"w":i=r(100)}return n(e,I++).width(a).height(i).css({top:s(1-c),left:s(1-u)})}function u(e){for(i in e)O[e[i]]=a(e[i])}function d(e){var t=Math.round(e.h/2-F),n=Math.round(e.w/2-F),r=(west=1-F,e.w-F),o=e.h-F;"e"in O&&O.e.css({top:s(t),left:s(r)})&&O.w.css({top:s(t)})&&O.s.css({top:s(o),left:s(n)})&&O.n.css({left:s(n)}),"ne"in O&&O.ne.css({left:s(r)})&&O.se.css({top:s(o),left:s(r)})&&O.sw.css({top:s(o)}),"b"in O&&O.b.css({top:s(o)})&&O.r.css({left:s(r)})}function l(e,t){Z.css({top:s(-t),left:s(-e)}),ee.css({top:s(t),left:s(e)})}function f(e,t){ee.width(e).height(t)}function h(){var e=re.getFixed();re.setPressed([e.x,e.y]),re.setCurrent([e.x2,e.y2]),p()}function p(){if(M)return w()}function w(){var e=re.getFixed();f(e.w,e.h),l(e.x,e.y),j.drawBorders&&H.right.css({left:s(e.w-1)})&&H.bottom.css({top:s(e.h-1)}),D&&d(e),M||g(),j.onChange(v(e))}function g(){ee.show(),K.css("opacity",j.bgOpacity),M=!0}function m(){S(),ee.hide(),K.css("opacity",1),M=!1}function y(){D&&(d(re.getFixed()),_.show())}function C(){if(D=!0,j.allowResize)return d(re.getFixed()),_.show(),!0}function S(){D=!1,_.hide()}function z(e){(N=e)?S():C()}function k(){z(!1),h()}var M,I=370,H={},O={},D=!1,F=j.handleOffset;j.drawBorders&&(H={top:t("hline").css("top",s(e.browser.msie?-1:0)),bottom:t("hline"),left:t("vline"),right:t("vline")}),j.dragEdges&&(O.t=c("n"),O.b=c("s"),O.r=c("e"),O.l=c("w")),j.sideHandles&&u(["n","s","e","w"]),j.cornerHandles&&u(["sw","nw","ne","se"]);var P=x().mousedown(b("move")).css({cursor:"move",position:"absolute",zIndex:360});return $.append(P),S(),{updateVisible:p,update:w,release:m,refresh:h,setCursor:function(e){P.css("cursor",e)},enableHandles:C,enableOnly:function(){D=!0},showHandles:y,disableHandles:S,animMode:z,done:k}}(),ie=function(){function t(){ne.css({zIndex:450}),d&&e(document).mousemove(s).mouseup(r)}function n(){ne.css({zIndex:290}),d&&e(document).unbind("mousemove",s).unbind("mouseup",r)}function s(e){a(c(e))}function r(e){return e.preventDefault(),e.stopPropagation(),G&&(G=!1,u(c(e)),j.onSelect(v(re.getFixed())),n(),a=function(){},u=function(){}),!1}function o(e,n){return G=!0,a=e,u=n,t(),!1}function i(e){ne.css("cursor",e)}var a=function(){},u=function(){},d=j.trackDocument;return d||ne.mousemove(s).mouseup(r).mouseout(r),K.before(ne),{activateHandlers:o,setCursor:i}}(),ae=function(){function t(){j.keySupport&&(o.show(),o.focus())}function n(e){o.hide()}function s(e,t,n){j.allowMove&&(re.moveOffset([t,n]),oe.updateVisible()),e.preventDefault(),e.stopPropagation()}function r(e){if(e.ctrlKey)return!0;U=!!e.shiftKey;var t=U?10:1;switch(e.keyCode){case 37:s(e,-t,0);break;case 39:s(e,t,0);break;case 38:s(e,0,-t);break;case 40:s(e,0,t);break;case 27:oe.release();break;case 9:return!0}return nothing(e)}var o=e('<input type="radio" />').css({position:"absolute",left:"-30px"}).keypress(r).blur(n),i=e("<div />").css({position:"absolute",overflow:"hidden"}).append(o);return j.keySupport&&i.insertBefore(K),{watchKeys:t}}();_.hide(),J(!0);var ce={animateTo:C,setSelect:S,setOptions:H,tellSelect:M,tellScaled:I,disable:O,enable:D,cancel:F,focus:ae.watchKeys,getBounds:function(){return[W*Y,A*q]},getWidgetSize:function(){return[W,A]},release:oe.release,destroy:P};return B.data("Jcrop",ce),ce},e.fn.Jcrop=function(t){function n(n){var s=t.useImg||n.src,r=new Image;r.onload=function(){e.Jcrop(n,t)},r.src=s}return"object"!=typeof t&&(t={}),this.each(function(){if(e(this).data("Jcrop")){if("api"==t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else n(this)}),this}}(jQuery);